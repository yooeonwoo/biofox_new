# Supabase 데이터베이스 현황

## 1. 시스템 개요

### 1.1 시스템 목적 및 기능

이 시스템은 리드 관리, 상점/KOL(Key Opinion Leader) 관리, 제품 관리, 세미나 관리, 작업 관리 등을 포함하는 통합 비즈니스 관리 시스템입니다. 주요 기능은 다음과 같습니다:

- 역할 기반 접근 제어 (RBAC)를 통한 사용자 권한 관리
- 리드의 획득, 관리, 전환 추적
- 상점, KOL, 제품, 고객 정보 관리
- 세미나 일정 관리 및 참석자 추적
- 작업 할당 및 추적
- 판매 및 수수료 관리
- 사용자 활동 로깅

### 1.2 주요 모듈 구성

시스템은 다음과 같은 주요 모듈로 구성되어 있습니다:

- **인증 및 권한 관리 모듈**: 사용자 인증, 역할 및 권한 관리
- **리드 관리 모듈**: 리드 추적, 상태 및 소스 관리
- **비즈니스 관리 모듈**: 상점, KOL, 제품, 고객 관리
- **세미나 관리 모듈**: 세미나 일정 및 참석자 관리
- **작업 관리 모듈**: 작업 할당, 상태 추적
- **판매 관리 모듈**: 판매 기록 및 수수료 관리
- **활동 추적 모듈**: 사용자 활동 로깅 및 알림

## 2. 데이터베이스 구조

### 2.1 테이블 그룹 개요

데이터베이스는 다음과 같은 논리적 그룹으로 구성되어 있습니다:

1. **인증 및 권한 관리**: `roles`, `permissions`, `role_permissions`, `users`, `user_roles`
2. **기본 정보**: `lead_sources`, `lead_statuses`, `product_categories`, `regions`, `settings`
3. **핵심 비즈니스 데이터**: `leads`, `shops`, `kols`, `products`, `customers`
4. **비즈니스 거래**: `sales`, `commissions`, `sales_activities`
5. **세미나 관리**: `seminars`, `seminar_attendees`
6. **작업 관리**: `tasks`, `notifications`, `activities`

### 2.2 테이블 간 주요 관계

- 사용자(`users`)는 역할(`roles`)과 다대다 관계입니다 (`user_roles` 테이블을 통해).
- 역할(`roles`)은 권한(`permissions`)과 다대다 관계입니다 (`role_permissions` 테이블을 통해).
- 리드(`leads`)는 리드 상태(`lead_statuses`)와 리드 소스(`lead_sources`)와 관계가 있습니다.
- 상점(`shops`)은 KOL(`kols`)과 양방향 관계가 있습니다.
- 작업(`tasks`)은 리드, 고객, 세미나 등 다양한 엔티티와 관계가 있습니다.
- 세미나(`seminars`)와 참석자(`seminar_attendees`) 사이에는 일대다 관계가 있습니다.

## 3. 테이블 상세 정보

### 3.1 인증 및 권한 관리 테이블

#### 3.1.1 roles (역할)

**설명**: 시스템 내 사용자 역할 정의

**스키마**:
| 필드 | 타입 | 설명 | 제약조건 |
|------|------|------|----------|
| id | integer | 역할 ID | PK, Auto Increment |
| name | text | 역할 이름 | NOT NULL, Unique |
| description | text | 역할 설명 | NULL 허용 |
| created_at | timestamp | 생성 일시 | NOT NULL, 기본값: now() |
| updated_at | timestamp | 수정 일시 | NOT NULL, 기본값: now() |

**레코드 수**: 6개

**관계**:
- `role_permissions` 테이블과 1:N 관계
- `user_roles` 테이블과 1:N 관계

**예시 데이터**:
- Admin (관리자): 모든 권한 보유
- Manager (매니저): 부분 관리 권한
- Sales (영업): 판매 관련 권한
- Support (지원): 고객 지원 권한
- Viewer (열람자): 읽기 전용 권한
- KOL (인플루언서): KOL 전용 권한

#### 3.1.2 permissions (권한)

**설명**: 시스템 내 개별 권한 정의

**스키마**:
| 필드 | 타입 | 설명 | 제약조건 |
|------|------|------|----------|
| id | integer | 권한 ID | PK, Auto Increment |
| name | text | 권한 이름 | NOT NULL, Unique |
| description | text | 권한 설명 | NULL 허용 |
| resource | text | 권한이 적용되는 리소스 | NOT NULL |
| action | text | 권한 액션 (create, read, update, delete) | NOT NULL |
| created_at | timestamp | 생성 일시 | NOT NULL, 기본값: now() |
| updated_at | timestamp | 수정 일시 | NOT NULL, 기본값: now() |

**레코드 수**: 86개

**관계**:
- `role_permissions` 테이블과 1:N 관계

**예시 데이터**:
- leads:create (리드 생성 권한)
- shops:read (상점 읽기 권한)
- users:update (사용자 수정 권한)
- products:delete (제품 삭제 권한)

#### 3.1.3 role_permissions (역할-권한 매핑)

**설명**: 역할과 권한 간의 다대다 관계 매핑

**스키마**:
| 필드 | 타입 | 설명 | 제약조건 |
|------|------|------|----------|
| id | integer | 매핑 ID | PK, Auto Increment |
| role_id | integer | 역할 ID | FK(roles.id), NOT NULL |
| permission_id | integer | 권한 ID | FK(permissions.id), NOT NULL |
| created_at | timestamp | 생성 일시 | NOT NULL, 기본값: now() |

**레코드 수**: 86개

**관계**:
- `roles` 테이블과 N:1 관계
- `permissions` 테이블과 N:1 관계

#### 3.1.4 users (사용자)

**설명**: 시스템 사용자 정보

**스키마**:
| 필드 | 타입 | 설명 | 제약조건 |
|------|------|------|----------|
| id | integer | 사용자 ID | PK, Auto Increment |
| email | text | 이메일 주소 | NOT NULL, Unique |
| password_hash | text | 비밀번호 해시 | NOT NULL |
| full_name | text | 사용자 이름 | NULL 허용 |
| role | text | 주 역할 (표시용) | NULL 허용 |
| profile_image | text | 프로필 이미지 URL | NULL 허용 |
| phone | text | 전화번호 | NULL 허용 |
| created_at | timestamp | 생성 일시 | NOT NULL, 기본값: now() |
| updated_at | timestamp | 수정 일시 | NOT NULL, 기본값: now() |

**레코드 수**: 68개

**관계**:
- `user_roles` 테이블과 1:N 관계
- `tasks` 테이블(assigned_to)과 1:N 관계
- `tasks` 테이블(assigned_by)과 1:N 관계
- `seminars` 테이블(organizer_id)과 1:N 관계
- `leads` 테이블(assigned_to)과 1:N 관계

#### 3.1.5 user_roles (사용자-역할 매핑)

**설명**: 사용자와 역할 간의 다대다 관계 매핑

**스키마**:
| 필드 | 타입 | 설명 | 제약조건 |
|------|------|------|----------|
| id | integer | 매핑 ID | PK, Auto Increment |
| user_id | integer | 사용자 ID | FK(users.id), NOT NULL |
| role_id | integer | 역할 ID | FK(roles.id), NOT NULL |
| created_at | timestamp | 생성 일시 | NOT NULL, 기본값: now() |
| updated_at | timestamp | 수정 일시 | NOT NULL, 기본값: now() |

**레코드 수**: 68개

**관계**:
- `users` 테이블과 N:1 관계
- `roles` 테이블과 N:1 관계

### 3.2 기본 정보 테이블

#### 3.2.1 lead_sources (리드 출처)

**설명**: 리드의 출처 정보

**스키마**:
| 필드 | 타입 | 설명 | 제약조건 |
|------|------|------|----------|
| id | integer | 출처 ID | PK, Auto Increment |
| name | text | 출처 이름 | NOT NULL, Unique |
| description | text | 출처 설명 | NULL 허용 |
| created_at | timestamp | 생성 일시 | NOT NULL, 기본값: now() |
| updated_at | timestamp | 수정 일시 | NOT NULL, 기본값: now() |

**레코드 수**: 8개

**관계**:
- `leads` 테이블(source_id)과 1:N 관계

**예시 데이터**:
- 메타 광고, 구글 광고, 웹사이트, 소개, 이벤트, 콜드 콜, SNS, 기타

#### 3.2.2 lead_statuses (리드 상태)

**설명**: 리드의 상태 정보

**스키마**:
| 필드 | 타입 | 설명 | 제약조건 |
|------|------|------|----------|
| id | integer | 상태 ID | PK, Auto Increment |
| name | text | 상태 이름 | NOT NULL, Unique |
| description | text | 상태 설명 | NULL 허용 |
| color | text | 상태 색상 코드 | NULL 허용 |
| order | integer | 정렬 순서 | NULL 허용 |
| created_at | timestamp | 생성 일시 | NOT NULL, 기본값: now() |
| updated_at | timestamp | 수정 일시 | NOT NULL, 기본값: now() |

**레코드 수**: 30개

**관계**:
- `leads` 테이블(status_id)과 1:N 관계

**예시 데이터**:
- 신규, 접촉 중, 미팅 예정, 제안 단계, 계약 중, 전환 완료, 거부됨, 휴면

#### 3.2.3 product_categories (제품 카테고리)

**설명**: 제품 카테고리 정보

**스키마**:
| 필드 | 타입 | 설명 | 제약조건 |
|------|------|------|----------|
| id | integer | 카테고리 ID | PK, Auto Increment |
| name | text | 카테고리 이름 | NOT NULL, Unique |
| description | text | 카테고리 설명 | NULL 허용 |
| parent_id | integer | 상위 카테고리 ID | FK(product_categories.id), NULL 허용 |
| created_at | timestamp | 생성 일시 | NOT NULL, 기본값: now() |
| updated_at | timestamp | 수정 일시 | NOT NULL, 기본값: now() |

**레코드 수**: 3개

**관계**:
- `products` 테이블(category_id)과 1:N 관계
- 자기 참조 관계(parent_id)로 계층 구조 형성

**예시 데이터**:
- 화장품, 건강보조식품, 생활용품

#### 3.2.4 regions (지역)

**설명**: 지역 정보

**스키마**:
| 필드 | 타입 | 설명 | 제약조건 |
|------|------|------|----------|
| id | integer | 지역 ID | PK, Auto Increment |
| name | text | 지역 이름 | NOT NULL |
| code | text | 지역 코드 | NULL 허용, Unique |
| parent_id | integer | 상위 지역 ID | FK(regions.id), NULL 허용 |
| level | integer | 지역 레벨 (1: 국가, 2: 도/시, 3: 구/군) | NULL 허용 |
| created_at | timestamp | 생성 일시 | NOT NULL, 기본값: now() |
| updated_at | timestamp | 수정 일시 | NOT NULL, 기본값: now() |

**레코드 수**: 50개

**관계**:
- `shops` 테이블(region_id)과 1:N 관계
- 자기 참조 관계(parent_id)로 계층 구조 형성

**예시 데이터**:
- 대한민국(레벨 1) > 서울특별시(레벨 2) > 강남구(레벨 3)

#### 3.2.5 settings (설정)

**설명**: 시스템 설정 정보

**스키마**:
| 필드 | 타입 | 설명 | 제약조건 |
|------|------|------|----------|
| id | integer | 설정 ID | PK, Auto Increment |
| key | text | 설정 키 | NOT NULL, Unique |
| value | text | 설정 값 | NULL 허용 |
| description | text | 설정 설명 | NULL 허용 |
| created_at | timestamp | 생성 일시 | NOT NULL, 기본값: now() |
| updated_at | timestamp | 수정 일시 | NOT NULL, 기본값: now() |

**레코드 수**: 5개

**관계**: 없음

**예시 데이터**:
- system_name: 시스템 이름
- company_address: 회사 주소
- support_email: 지원 이메일
- sales_tax_rate: 판매세율
- default_currency: 기본 통화

### 3.3 핵심 비즈니스 데이터 테이블

#### 3.3.1 leads (리드)

**설명**: 잠재 고객 정보

**스키마**:
| 필드 | 타입 | 설명 | 제약조건 |
|------|------|------|----------|
| id | integer | 리드 ID | PK, Auto Increment |
| name | text | 리드 이름 | NOT NULL |
| email | text | 이메일 주소 | NULL 허용 |
| phone | text | 전화번호 | NULL 허용 |
| status_id | integer | 리드 상태 ID | FK(lead_statuses.id), NOT NULL |
| source_id | integer | 리드 출처 ID | FK(lead_sources.id), NOT NULL |
| assigned_to | integer | 담당자 ID | FK(users.id), NULL 허용 |
| notes | text | 메모 | NULL 허용 |
| created_at | timestamp | 생성 일시 | NOT NULL, 기본값: now() |
| updated_at | timestamp | 수정 일시 | NOT NULL, 기본값: now() |
| seminar_reservation_date | timestamp | 세미나 예약 일시 | NULL 허용 |
| cafe_id | text | 카페 ID | NULL 허용 |

**레코드 수**: 722개

**관계**:
- `lead_statuses` 테이블과 N:1 관계
- `lead_sources` 테이블과 N:1 관계
- `users` 테이블(assigned_to)과 N:1 관계
- `shops` 테이블(converted_from_lead_id)과 1:N 관계
- `tasks` 테이블(lead_id)과 1:N 관계

#### 3.3.2 shops (상점)

**설명**: 상점 정보

**스키마**:
| 필드 | 타입 | 설명 | 제약조건 |
|------|------|------|----------|
| id | integer | 상점 ID | PK, Auto Increment |
| name | text | 상점 이름 | NOT NULL |
| owner_name | text | 사장 이름 | NULL 허용 |
| address | text | 주소 | NULL 허용 |
| phone | text | 전화번호 | NULL 허용 |
| email | text | 이메일 주소 | NULL 허용 |
| business_number | text | 사업자 등록번호 | NULL 허용 |
| status | text | 상태 (active, inactive) | NOT NULL, 기본값: 'active' |
| manager_id | integer | 담당 매니저 ID | FK(users.id), NULL 허용 |
| region_id | integer | 지역 ID | FK(regions.id), NULL 허용 |
| created_at | timestamp | 생성 일시 | NOT NULL, 기본값: now() |
| updated_at | timestamp | 수정 일시 | NOT NULL, 기본값: now() |
| converted_from_lead_id | integer | 전환된 리드 ID | FK(leads.id), NULL 허용 |
| kol_id | integer | 연관 KOL ID | FK(kols.id), NULL 허용 |

**레코드 수**: 40개

**관계**:
- `regions` 테이블과 N:1 관계
- `users` 테이블(manager_id)과 N:1 관계
- `leads` 테이블(converted_from_lead_id)과 N:1 관계
- `kols` 테이블과 N:1 관계
- `products` 테이블과 1:N 관계
- `sales` 테이블(shop_id)과 1:N 관계

#### 3.3.3 kols (Key Opinion Leaders)

**설명**: 인플루언서(KOL) 정보

**스키마**:
| 필드 | 타입 | 설명 | 제약조건 |
|------|------|------|----------|
| id | integer | KOL ID | PK, Auto Increment |
| name | text | KOL 이름 | NOT NULL |
| email | text | 이메일 주소 | NULL 허용 |
| phone | text | 전화번호 | NULL 허용 |
| social_media_handle | text | 소셜 미디어 핸들 | NULL 허용 |
| followers_count | integer | 팔로워 수 | NULL 허용 |
| status | text | 상태 (active, inactive) | NOT NULL, 기본값: 'active' |
| created_at | timestamp | 생성 일시 | NOT NULL, 기본값: now() |
| updated_at | timestamp | 수정 일시 | NOT NULL, 기본값: now() |

**레코드 수**: 27개

**관계**:
- `shops` 테이블(kol_id)과 1:N 관계
- `commissions` 테이블(kol_id)과 1:N 관계

#### 3.3.4 products (제품)

**설명**: 제품 정보

**스키마**:
| 필드 | 타입 | 설명 | 제약조건 |
|------|------|------|----------|
| id | integer | 제품 ID | PK, Auto Increment |
| name | text | 제품 이름 | NOT NULL |
| description | text | 제품 설명 | NULL 허용 |
| price | decimal | 가격 | NULL 허용 |
| category_id | integer | 카테고리 ID | FK(product_categories.id), NULL 허용 |
| shop_id | integer | 판매 상점 ID | FK(shops.id), NULL 허용 |
| status | text | 상태 (active, inactive) | NOT NULL, 기본값: 'active' |
| created_at | timestamp | 생성 일시 | NOT NULL, 기본값: now() |
| updated_at | timestamp | 수정 일시 | NOT NULL, 기본값: now() |

**레코드 수**: 8개

**관계**:
- `product_categories` 테이블과 N:1 관계
- `shops` 테이블과 N:1 관계
- `sales` 테이블(product_id)과 1:N 관계

#### 3.3.5 customers (고객)

**설명**: 고객 정보

**스키마**:
| 필드 | 타입 | 설명 | 제약조건 |
|------|------|------|----------|
| id | integer | 고객 ID | PK, Auto Increment |
| name | text | 고객 이름 | NOT NULL |
| email | text | 이메일 주소 | NULL 허용 |
| phone | text | 전화번호 | NULL 허용 |
| address | text | 주소 | NULL 허용 |
| shop_id | integer | 관련 상점 ID | FK(shops.id), NULL 허용 |
| notes | text | 메모 | NULL 허용 |
| created_at | timestamp | 생성 일시 | NOT NULL, 기본값: now() |
| updated_at | timestamp | 수정 일시 | NOT NULL, 기본값: now() |

**레코드 수**: 20개

**관계**:
- `shops` 테이블과 N:1 관계
- `sales` 테이블(customer_id)과 1:N 관계
- `tasks` 테이블(customer_id)과 1:N 관계

### 3.4 비즈니스 거래 테이블

#### 3.4.1 sales (판매)

**설명**: 판매 정보

**스키마**:
| 필드 | 타입 | 설명 | 제약조건 |
|------|------|------|----------|
| id | integer | 판매 ID | PK, Auto Increment |
| shop_id | integer | 판매 상점 ID | FK(shops.id), NOT NULL |
| product_id | integer | 제품 ID | FK(products.id), NOT NULL |
| customer_id | integer | 고객 ID | FK(customers.id), NULL 허용 |
| quantity | integer | 수량 | NOT NULL, 기본값: 1 |
| total_amount | decimal | 총 금액 | NOT NULL |
| sale_date | timestamp | 판매 일자 | NOT NULL, 기본값: now() |
| status | text | 상태 (completed, refunded, etc) | NOT NULL, 기본값: 'completed' |
| created_at | timestamp | 생성 일시 | NOT NULL, 기본값: now() |
| updated_at | timestamp | 수정 일시 | NOT NULL, 기본값: now() |

**레코드 수**: 5개

**관계**:
- `shops` 테이블과 N:1 관계
- `products` 테이블과 N:1 관계
- `customers` 테이블과 N:1 관계
- `commissions` 테이블(sale_id)과 1:N 관계

#### 3.4.2 commissions (수수료)

**설명**: KOL 수수료 정보

**스키마**:
| 필드 | 타입 | 설명 | 제약조건 |
|------|------|------|----------|
| id | integer | 수수료 ID | PK, Auto Increment |
| sale_id | integer | 관련 판매 ID | FK(sales.id), NOT NULL |
| kol_id | integer | KOL ID | FK(kols.id), NOT NULL |
| amount | decimal | 수수료 금액 | NOT NULL |
| rate | decimal | 수수료 비율 | NULL 허용 |
| status | text | 상태 (pending, paid, cancelled) | NOT NULL, 기본값: 'pending' |
| payment_date | timestamp | 지급 일자 | NULL 허용 |
| created_at | timestamp | 생성 일시 | NOT NULL, 기본값: now() |
| updated_at | timestamp | 수정 일시 | NOT NULL, 기본값: now() |

**레코드 수**: 5개

**관계**:
- `sales` 테이블과 N:1 관계
- `kols` 테이블과 N:1 관계

#### 3.4.3 sales_activities (판매 활동)

**설명**: 판매 관련 활동 기록

**스키마**:
| 필드 | 타입 | 설명 | 제약조건 |
|------|------|------|----------|
| id | integer | 활동 ID | PK, Auto Increment |
| shop_id | integer | 상점 ID | FK(shops.id), NOT NULL |
| user_id | integer | 사용자 ID | FK(users.id), NOT NULL |
| activity_type | text | 활동 유형 (visit, call, demo, etc) | NOT NULL |
| description | text | 활동 설명 | NULL 허용 |
| activity_date | timestamp | 활동 일자 | NOT NULL, 기본값: now() |
| created_at | timestamp | 생성 일시 | NOT NULL, 기본값: now() |
| updated_at | timestamp | 수정 일시 | NOT NULL, 기본값: now() |

**레코드 수**: 10개

**관계**:
- `shops` 테이블과 N:1 관계
- `users` 테이블과 N:1 관계

### 3.5 세미나 관리 테이블

#### 3.5.1 seminars (세미나)

**설명**: 세미나 정보

**스키마**:
| 필드 | 타입 | 설명 | 제약조건 |
|------|------|------|----------|
| id | integer | 세미나 ID | PK, Auto Increment |
| title | text | 세미나 제목 | NOT NULL |
| description | text | 세미나 설명 | NULL 허용 |
| location | text | 세미나 장소 | NULL 허용 |
| start_date | timestamp | 시작 일시 | NOT NULL |
| end_date | timestamp | 종료 일시 | NOT NULL |
| organizer_id | integer | 주최자 ID | FK(users.id), NOT NULL |
| max_attendees | integer | 최대 참석자 수 | NULL 허용 |
| status | text | 상태 (scheduled, cancelled, completed) | NOT NULL, 기본값: 'scheduled' |
| created_at | timestamp | 생성 일시 | NOT NULL, 기본값: now() |
| updated_at | timestamp | 수정 일시 | NOT NULL, 기본값: now() |

**레코드 수**: 3개

**관계**:
- `users` 테이블(organizer_id)과 N:1 관계
- `seminar_attendees` 테이블(seminar_id)과 1:N 관계
- `tasks` 테이블(seminar_id)과 1:N 관계

#### 3.5.2 seminar_attendees (세미나 참석자)

**설명**: 세미나 참석자 정보

**스키마**:
| 필드 | 타입 | 설명 | 제약조건 |
|------|------|------|----------|
| id | integer | 참석자 ID | PK, Auto Increment |
| seminar_id | integer | 세미나 ID | FK(seminars.id), NOT NULL |
| name | text | 참석자 이름 | NOT NULL |
| email | text | 이메일 주소 | NULL 허용 |
| phone | text | 전화번호 | NULL 허용 |
| status | text | 상태 (registered, attended, no_show) | NOT NULL, 기본값: 'registered' |
| lead_id | integer | 리드 ID | FK(leads.id), NULL 허용 |
| shop_id | integer | 상점 ID | FK(shops.id), NULL 허용 |
| kol_id | integer | KOL ID | FK(kols.id), NULL 허용 |
| created_at | timestamp | 생성 일시 | NOT NULL, 기본값: now() |
| updated_at | timestamp | 수정 일시 | NOT NULL, 기본값: now() |

**레코드 수**: 24개

**관계**:
- `seminars` 테이블과 N:1 관계
- `leads` 테이블과 N:1 관계
- `shops` 테이블과 N:1 관계
- `kols` 테이블과 N:1 관계

### 3.6 작업 관리 테이블

#### 3.6.1 tasks (작업)

**설명**: 작업 관리 정보

**스키마**:
| 필드 | 타입 | 설명 | 제약조건 |
|------|------|------|----------|
| id | integer | 작업 ID | PK, Auto Increment |
| title | text | 작업 제목 | NOT NULL |
| description | text | 작업 설명 | NULL 허용 |
| assigned_to | integer | 담당자 ID | FK(users.id), NOT NULL |
| assigned_by | integer | 할당자 ID | FK(users.id), NOT NULL |
| due_date | timestamp | 마감 일시 | NULL 허용 |
| priority | text | 우선순위 (high, medium, low) | NOT NULL, 기본값: 'medium' |
| status | text | 상태 (pending, in_progress, completed) | NOT NULL, 기본값: 'pending' |
| lead_id | integer | 관련 리드 ID | FK(leads.id), NULL 허용 |
| customer_id | integer | 관련 고객 ID | FK(customers.id), NULL 허용 |
| seminar_id | integer | 관련 세미나 ID | FK(seminars.id), NULL 허용 |
| created_at | timestamp | 생성 일시 | NOT NULL, 기본값: now() |
| updated_at | timestamp | 수정 일시 | NOT NULL, 기본값: now() |

**레코드 수**: 20개

**관계**:
- `users` 테이블(assigned_to)과 N:1 관계
- `users` 테이블(assigned_by)과 N:1 관계
- `leads` 테이블과 N:1 관계
- `customers` 테이블과 N:1 관계
- `seminars` 테이블과 N:1 관계

#### 3.6.2 notifications (알림)

**설명**: 사용자 알림 정보

**스키마**:
| 필드 | 타입 | 설명 | 제약조건 |
|------|------|------|----------|
| id | integer | 알림 ID | PK, Auto Increment |
| user_id | integer | 수신자 ID | FK(users.id), NOT NULL |
| title | text | 알림 제목 | NOT NULL |
| content | text | 알림 내용 | NULL 허용 |
| type | text | 알림 유형 (task, lead, system, etc) | NULL 허용 |
| is_read | boolean | 읽음 여부 | NOT NULL, 기본값: false |
| related_entity_type | text | 관련 엔티티 유형 | NULL 허용 |
| related_entity_id | integer | 관련 엔티티 ID | NULL 허용 |
| created_at | timestamp | 생성 일시 | NOT NULL, 기본값: now() |
| updated_at | timestamp | 수정 일시 | NOT NULL, 기본값: now() |

**레코드 수**: 15개

**관계**:
- `users` 테이블과 N:1 관계

#### 3.6.3 activities (활동)

**설명**: 사용자 활동 로그

**스키마**:
| 필드 | 타입 | 설명 | 제약조건 |
|------|------|------|----------|
| id | integer | 활동 ID | PK, Auto Increment |
| user_id | integer | 사용자 ID | FK(users.id), NOT NULL |
| action | text | 수행한 작업 | NOT NULL |
| entity_type | text | 엔티티 유형 (lead, shop, task, etc) | NOT NULL |
| entity_id | integer | 엔티티 ID | NOT NULL |
| details | text | 활동 상세 내용 | NULL 허용 |
| created_at | timestamp | 생성 일시 | NOT NULL, 기본값: now() |

**레코드 수**: 25개

**관계**:
- `users` 테이블과 N:1 관계

## 4. 업무 로직 시나리오

### 4.1 리드 발굴부터 고객 전환까지의 프로세스

1. **리드 획득**:
   - 다양한 출처(소스)에서 리드 정보를 획득
   - `lead_sources` 테이블에서 리드 출처 관리
   - `leads` 테이블에 리드 정보 저장

2. **리드 상태 관리**:
   - `lead_statuses` 테이블을 통해 리드 상태 관리
   - 리드 처리 과정에 따라 상태 변경 (신규 → 접촉 중 → 미팅 예정 → 제안 단계 → 계약 중 → 전환 완료)

3. **리드 할당 및 작업 관리**:
   - 리드에 담당자 할당 (`leads.assigned_to`)
   - `tasks` 테이블을 통해 리드 관련 작업 생성 및 관리

4. **리드-상점 전환**:
   - 리드가 고객으로 전환되면 `shops` 테이블에 정보 저장
   - `shops.converted_from_lead_id`를 통해 원래 리드 추적 가능

### 4.2 상점 및 KOL 관리 프로세스

1. **상점 관리**:
   - `shops` 테이블에 상점 정보 관리
   - 지역별 관리를 위해 `regions` 테이블과 연결
   - 담당 매니저 지정 (`shops.manager_id`)

2. **KOL 연결**:
   - `kols` 테이블에 KOL(인플루언서) 정보 관리
   - `shops.kol_id`를 통해 상점과 KOL 연결
   - `updateShopKolRelationships` 함수로 양방향 관계 관리

3. **제품 및 판매 관리**:
   - `products` 테이블에 제품 정보 관리
   - `sales` 테이블을 통해 판매 기록
   - `commissions` 테이블에서 KOL 수수료 관리

4. **판매 활동 추적**:
   - `sales_activities` 테이블을 통해 상점 방문, 통화 등 활동 기록

### 4.3 세미나 관리 프로세스

1. **세미나 계획 및 생성**:
   - `seminars` 테이블에 세미나 정보 저장
   - 세미나 주최자, 장소, 일정 등 관리

2. **참석자 등록 및 관리**:
   - `seminar_attendees` 테이블에 참석자 정보 관리
   - 참석자는 리드, 상점, KOL 등 다양한 엔티티와 연결 가능

3. **세미나 관련 작업 관리**:
   - `tasks` 테이블을 통해 세미나 준비, 참석자 관리 등 작업 할당

4. **세미나 성과 분석**:
   - 세미나 참석 후 리드 전환율 추적
   - 세미나 참석자의 후속 활동 관리

### 4.4 작업 할당 및 관리 프로세스

1. **작업 생성 및 할당**:
   - `tasks` 테이블에 작업 정보 저장
   - 담당자(assigned_to)와 할당자(assigned_by) 지정

2. **작업 우선순위 및 상태 관리**:
   - 우선순위(priority): high, medium, low
   - 상태(status): pending, in_progress, completed

3. **작업 관련 알림**:
   - `notifications` 테이블을 통해 작업 할당, 마감 임박 등 알림 관리

4. **작업 활동 로깅**:
   - `activities` 테이블을 통해 작업 관련 활동 기록

## 5. 데이터 관계도

### 5.1 인증 및 권한 관리 관계도
```
roles <-- role_permissions --> permissions
  ^
  |
users <-- user_roles --> roles
```

### 5.2 리드 관리 관계도
```
lead_sources --> leads <-- lead_statuses
                  |
                  v
                shops <-- regions
```

### 5.3 상점 및 제품 관계도
```
        kols
          ^
          |
regions --> shops --> products <-- product_categories
          |     |
          |     v
          |   sales --> commissions
          |     ^
          v     |
      customers
```

### 5.4 작업 및 세미나 관계도
```
          leads 
          /   \
         /     \
tasks <--      seminars
  ^     \     /
  |      \   /
users     \ /
  ^     seminar_attendees
  |
notifications
  |
activities
```

## 6. 결론

이 시스템은 리드 관리, 상점 관리, KOL 관리, 세미나 관리, 작업 관리 등을 통합하여 비즈니스 운영을 효율적으로 지원하는 종합 관리 시스템입니다. 사용자 역할 기반 접근 제어를 통해 다양한 사용자 그룹에게 적절한 권한을 부여하며, 리드부터 고객 전환까지의 전체 프로세스를 추적하고 관리할 수 있습니다.

주요 테이블 간의 관계는 업무 흐름을 반영하며, 각 테이블은 특정 업무 영역에 맞게 설계되어 있습니다. 총 23개의 테이블로 구성된 이 데이터베이스는 비즈니스 운영의 핵심 데이터를 효과적으로 관리하고 활용할 수 있는 구조로 설계되어 있습니다.
