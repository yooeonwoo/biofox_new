아래는 **전체 테이블**에 대한 **권장 입력 순서**와 함께,  
**현재 CSV가 실제로 제공된 테이블들(lead_sources, lead_statuses, leads, permissions, product_categories, products, regions, roles, shops, users 등)**을 **상세하게** 다루는 **보완 확장판**입니다.  
(그 외 CSV가 없는 테이블은 **목업 데이터**를 활용하시면 됩니다.)

---

## 0. 전제 요약

- **CSV**에 담긴 **`id` 컬럼**은 대부분 비어 있거나, 혹은 별도로 **수동 지정**(예: `regions.id=1..50`)되어 있을 수 있습니다.  
  - 만약 테이블에 **`id serial(또는 identity)`**가 설정되어 있다면, CSV의 `id` 컬럼을 무시하고, DB에서 자동 증가시키는 것이 일반적입니다.  
  - 다만 `regions`처럼 이미 **명시적 id**가 있는 경우에는 **수동 삽입** 후 **시퀀스**를 조정(예: `ALTER SEQUENCE regions_id_seq RESTART WITH 51;`)해야 합니다.
- **날짜 컬럼**(예: `created_at`, `updated_at`)이 비어 있거나 `YYYY/MM/DD` 형태라면, Import 시 **`YYYY-MM-DD`**로 변환하거나, 빈 값은 `NOW()`로 대체합니다.
- **빈 칸**(null 값) 처리:  
  - FK 컬럼(예: `source_id`, `status_id`, `assigned_to`)이 비면 → `NULL`로 처리하거나, 미리 정해둔 default 값(예: “신규=1”)을 할당  
  - 문자열 컬럼(이메일, 전화번호 등)이 비면 → `NULL`  
  - 숫자(`price`, `commission_rate` 등)에서 `%`가 포함된 경우(예: `100%`) → numeric(100.00)으로 변환

---

## 1. **전체 테이블** 간 **FK 관계** (요약)

(이미 안내해 드린 내용이지만, 다시 한 번 정리)

1. **roles** / **permissions**: 독립  
2. **role_permissions**: `role_id → roles.id`, `permission_id → permissions.id`  
3. **users**: FK 없음 (단, `role`이라는 텍스트 컬럼 존재)  
4. **user_roles**: `user_id → users.id`, `role_id → roles.id`  

5. **lead_sources**, **lead_statuses**, **settings**: 독립  
6. **product_categories**: 자기 자신 참조(`parent_id → product_categories.id`)  
7. **regions**: 자기 자신 참조(`parent_id → regions.id`)  

8. **leads**: `source_id → lead_sources.id`, `status_id → lead_statuses.id`, `assigned_to → users.id`  
9. **shops**: `converted_from_lead_id → leads.id`, `manager_id → users.id`, `region_id → regions.id`, `kol_id → kols.id (나중)`  
10. **kols**: `user_id → users.id`, `affiliated_shop_id → shops.id`, `parent_kol_id → kols.id`  
11. **customers**: `lead_id → leads.id`, `shop_id → shops.id`, `assigned_to → users.id`  
12. **products**: `category_id → product_categories.id`  
13. **sales**: `product_id`, `customer_id`, `shop_id`, `sales_rep_id (users.id)`, `kol_id (kols.id)`  
14. **commissions**: `sale_id → sales.id`  
15. **sales_activities**: `user_id`, `shop_id`, `lead_id`, `customer_id`  
16. **seminars** (목업 가능)  
17. **seminar_attendees**: `seminar_id, lead_id`  
18. **tasks**: `assigned_to, assigned_by`, `lead_id`, `customer_id`, `seminar_id`  
19. **notifications**: `user_id`, `lead_id`, `customer_id`, `seminar_id`, `task_id`  
20. **activities**: `user_id`, `lead_id`, `customer_id`, `seminar_id`  

---

## 2. **권장 데이터 입력 순서** (부모 → 자식)

### 2.1 **(1) roles** (CSV: **roles.csv**)

- CSV 예시:  
  ```
  id,name,description,created_at,updated_at
  ,Admin,모든 기능에 접근 가능,,
  ,Sales Manager,영업 팀 관리 및 모든 영업 데이터 접근,,
  ...
  ```
- **비어있는 `id`**: DB에서 auto-increment.
- **`name`**: "Admin", "Sales Manager", "Sales Rep", "KOL", "Marketing", "SHOP" 등  
- **`description`**은 CSV에 있는 경우 그대로.  
- **`created_at`, `updated_at`**은 비어 있으면 `NOW()`.

### 2.2 **(2) permissions** (CSV: **permissions.csv**)

- CSV에 수십 건의 권한(`leads.create`, `leads.read`, …)이 나열되어 있음.
- `id` 비어 있으므로 auto-increment.
- `name`, `description`, `resource`, `action`을 매핑.
- `created_at`, `updated_at` 비어 있으면 `NOW()`.

### 2.3 **(3) role_permissions** (CSV 없음)

- 만약 **roles**와 **permissions**를 매핑할 필요가 있다면,  
- 예: Admin → 모든 permissions, Sales Rep → leads.read, leads.update만 …  
- 이건 별도 CSV가 없으니, **수동** 또는 **간단한 스크립트**로 삽입.

---

### 2.4 **(4) users** (CSV: **users.csv**)

- CSV 예시:  
  ```
  id,email,password_hash,full_name,role,profile_image,phone,created_at,updated_at
  ,zardu80@gmail.com,,이슬기,KOL,https://example.com/image.jpg,010-2883-4538,,
  ...
  ,,,김은형,SHOP,https://example.com/image.jpg,,,
  ...
  ```
- 위처럼 **중간에 email이 비고, full_name/role만 채워진** 케이스들이 있음(아래쪽 "SHOP" rows).
  - 이런 경우 **`email`**이 **NOT NULL** 제약이 있으므로, DB에서 INSERT 시 **무작위 값**(예: `placeholderXX@shop.com`) 또는 **임시 값**을 넣어야 합니다.
  - **`password_hash`**도 NOT NULL 이므로, 임시 `"TODO_HASH"` 같은 값이라도 넣어야 함.
- `role`은 CSV에 "KOL" / "SHOP" / "Admin" 등 문자열로 되어 있음.  
  - DB에선 그냥 text로 저장되므로 OK. (혹은 `user_roles`를 따로 사용하려면, 이 `role` 텍스트 컬럼 대신 `user_roles`로 매핑)
- `created_at`, `updated_at`이 비면 `NOW()`.

#### 비고
- SHOP 역할 유저들(이메일이 비어 있는 행)은 **한꺼번에 Insert** 하되, 위와 같이 `email` / `password_hash`를 임시 채우는 식으로 처리해야 합니다.

### 2.5 **(5) user_roles** (CSV 없음)

- 필요하다면,  
  - 예: user_id=1 (admin@domain.com), role_id=1 (Admin) 등등을 연결  
- 별도 CSV가 없으므로, **직접** 넣어야 함.

---

### 2.6 **(6) lead_sources** (CSV: **lead_sources.csv**)

- 예시:  
  ```
  id,name,description
  ,메타 광고,메타 광고 유입
  ,네이버 카페,네이버 카페 연락
  ,방문 시연,영업팀 방문 시연
  ,지인 소개,지인 소개
  ```
- `id` 비어 있으므로 auto-increment.  
- `name`과 `description`만 저장.  
- `created_at`, `updated_at`은 INSERT 시 `NOW()`.

### 2.7 **(7) lead_statuses** (CSV: **lead_statuses.csv**)

- 예시:  
  ```
  id,name,description,order,color
  ,신규,처음 시스템에 등록된 리드,1,#3498db
  ,접촉중,연락을 시도하는 단계,2,#f39c12
  ...
  ```
- `id` 비면 auto-increment.
- `name, description, order, color` 매핑.  
- `created_at, updated_at`은 `NOW()`.

---

### 2.8 **(8) product_categories** (CSV: **product_categories.csv**)

- 예:  
  ```
  id,name,code,parent_id,description,created_at,updated_at
  ,마이크로젯,microjet,1,레이저기기,,
  ,바이오폭스,biofox,1,제품,,
  ```
- 여기서 주의: `parent_id=1`이라고 써 있는데, 실제로 **`id=1`**인 “루트 카테고리”가 먼저 존재해야 합니다.  
  - 테이블 비어 있는 상태라면, **직접** “ROOT”용 레코드를 `id=1`로 Insert한 뒤 → CSV 데이터(마이크로젯, 바이오폭스)를 넣어야 `parent_id=1`이 참조 가능.
- 즉, **먼저**:
  ```sql
  INSERT INTO product_categories(id, name, code, parent_id, description, created_at, updated_at)
  VALUES (1, 'ROOT', 'root', NULL, '최상위 카테고리', now(), now());
  ```
  - 그런 뒤 CSV rows를 Insert (id는 auto-increment or ignored, `parent_id=1`).
- `created_at, updated_at`은 `NOW()`.

---

### 2.9 **(9) regions** (CSV: **regions.csv**)

- CSV에 `id=1..50`이 **명시**돼 있음(대한민국=1, 서울=2, …).  
- 이럴 때는 **테이블의 id 시퀀스**를 조정하거나, **수동 삽입** 모드(“identity override”)를 사용해야 합니다.  
- `parent_id`와 `level`도 CSV에 기재돼 있으므로,  
  - 예) id=2(서울특별시)는 parent_id=1(대한민국) → level=2  
- 그냥 CSV 순서대로 Insert하면 “먼저 id=1인 대한민국”이 들어가고 → 그다음 id=2(서울) 등이 들어가므로 FK 오륜 없을 것 같습니다.  
- 날짜(`created_at`, `updated_at`)는 비었으니 `NOW()`.

---

### 2.10 **(10) settings** (CSV 없음)

- 독립 테이블. 필요 시 **목업** 1~2건 넣어서 사용.

---

### 2.11 **(11) leads** (CSV: **leads.csv**)

- 컬럼:  
  - `id, name, email, phone, status_id, source_id, assigned_to, notes, created_at, updated_at, ...`  
- CSV에 예시로 매우 많은 행이 있음.  
- 주의사항:  
  - **`status_id`, `source_id`**가 대부분 비어 있음 → `NULL` 또는 기본값(예: “신규=1” / “메타 광고=1”)  
  - **`assigned_to`**가 비어 있음 → `NULL` (또는 특정 사용자 ID)  
  - **`created_at`**이 `"2025/03/19"` 이런 식 → PostgreSQL은 `YYYY-MM-DD` 필요. Import 시 변환 or `TO_DATE()` 사용.  
  - **`updated_at`**이 비어 있으면 `NOW()` 또는 `created_at`과 동일하게.
- `id`는 비면 auto-increment.

---

### 2.12 **(12) shops** (CSV: **shops.csv**)

- 예시:  
  ```
  id,name,owner_name,address,phone,email,business_number,status,manager_id,region_id,created_at,updated_at
  ,건강한 아름다움 휴,김은형,,,,,,,active,,
  ,킴웰니스,김지수,,,,,,,active,,
  ...
  ```
- **`status`**: "active"로 들어있음 → 그대로 매핑.  
- `manager_id`, `region_id`는 비었으므로 → `NULL`.  
- `created_at`, `updated_at` 비면 `NOW()`.  
- `converted_from_lead_id`와 `kol_id`는 CSV 컬럼에 없으므로, Insert 시 **NULL**로.  
  - **특히 `kol_id`**는 나중에 `kols`가 생성된 후 UPDATE가 필요할 수도 있음.

---

### 2.13 **(13) kols** (CSV 없음)

- CSV가 없으므로, 사용하려면 **mock data**를 넣거나, 혹은 향후 실제 파일을 받으면 추가.  
- `user_id`, `affiliated_shop_id`, `parent_kol_id` 등이 FK라서, **먼저 `users`**, `shops`가 채워져 있어야 함.

---

### 2.14 **(14) products** (CSV: **products.csv**)

- 예:  
  ```
  id,name,code,category_id,description,price,commission_rate,created_at,updated_at
  ,마이크로젯 레이저,microjet,1,마이크로젯 레이저,1500000,100%,,
  ,큐어부스터,mist,2,큐어부스터 미스트,75000,30%,,
  ...
  ```
- `category_id=1`(마이크로젯), `2`(바이오폭스) 등으로 돼 있음. → **`product_categories`**에서 1=마이크로젯(상위), 2=바이오폭스(하위)로 매핑이 잘 맞아야 함.  
- **`commission_rate`**가 “100%” → `100.00` 식으로 변환, “30%” → `30.00`  
- `price=1500000`(1,500,000원) 등 숫자 처리  
- 날짜 컬럼 비어있으면 `NOW()`.

---

### 2.15 **(15) customers** (CSV 없음)

- 만약 고객 CSV가 있다면, `lead_id → leads.id`, `shop_id → shops.id`, `assigned_to → users.id`.  
- 없으면 목업을 1~2건 Insert.

---

### 2.16 이후 테이블 (sales, commissions, sales_activities, seminars, seminar_attendees, tasks, notifications, activities 등)

- 모두 FK가 연결돼 있거나, CSV가 없는 경우가 대부분이므로,  
- 필요 시 **목업**으로 연결.  
- 예: `sales`를 넣으려면 **`products`, `customers`, `users`, `shops`, `kols`**가 먼저 있어야 하며,  
- `commissions`를 넣으려면 **sales**가 있어야 하는 식입니다.

---

## 3. **(양방향/자기참조 주의)**

1. **shops.kol_id ↔ kols.affiliated_shop_id**:  
   - 서로 참조 시, INSERT 때 한쪽을 `NULL`로 두고 → 나중에 UPDATE.
2. **product_categories**: parent부터 자식 순  
3. **regions**: 상위(대한민국=1)부터 → 하위(서울=2) → 그 하위(강남구=19) 순  
4. **kols**: 상위 kol → 하위 kol.  

---

## 4. **CSV마다 상세 주의사항 정리**

### 4.1 **lead_sources.csv**

- 테이블: **lead_sources**  
- 주요 컬럼: `id, name, description`  
- “**id**”가 비어 있음 → DB에서 auto-increment  
- `name`은 예) “메타 광고”, “네이버 카페”, “방문 시연”, “지인 소개”  
- `description`은 간단한 설명(“메타 광고 유입”, “네이버 카페 연락”, …)  
- `created_at`, `updated_at`은 **없으므로** Insert 시 `NOW()` 처리.

### 4.2 **lead_statuses.csv**

- 테이블: **lead_statuses**  
- 주요 컬럼: `id, name, description, order, color`  
- “**id**” 비어 있음 → auto-increment  
- 예) “신규(1, #3498db)”, “접촉중(2)”, “관심있음(3)”, … “경쟁사선택(15)”  
- **order**(정수)와 **color**(문자열, #hex)  
- `created_at`, `updated_at`은 비면 `NOW()`로.

### 4.3 **leads.csv**

- 테이블: **leads**  
- 컬럼: `id, name, email, phone, status_id, source_id, assigned_to, notes, created_at, updated_at, ...`  
- CSV에 **수백 건** 있을 수 있음.  
- 대부분 `status_id`, `source_id`, `assigned_to`가 비어 있음 → `NULL` 처리 (또는 default).  
- **날짜 컬럼**: `"YYYY/MM/DD"` → `"YYYY-MM-DD"` 변환.  
- `notes` 안에 **콤마**, **줄바꿈** 등 특수문자가 있을 수 있으므로, CSV import 시 인용부호("…") 처리를 주의해야 함.  
- `id`는 auto-increment.

### 4.4 **permissions.csv**

- 테이블: **permissions**  
- 컬럼: `id, name, description, resource, action, created_at, updated_at`  
- CSV에 약 70개 권한(예: `leads.create`, `leads.read` …)이 정의됨.  
- “**id**” 비면 auto-increment.  
- `name`(고유), `description`, `resource`, `action` 매핑  
- `created_at`, `updated_at` 없으니 `NOW()`.

### 4.5 **product_categories.csv**

- 테이블: **product_categories**  
- CSV에 “마이크로젯(microjet, parent=1), 바이오폭스(biofox, parent=1)” 2건  
- **루트 카테고리**(id=1, name=“ROOT”)는 **직접** 수동 Insert 후, CSV 2건을 넣으면 `parent_id=1`로 FK 만족.

### 4.6 **products.csv**

- 테이블: **products**  
- CSV 예:  
  ```
  (1) 마이크로젯 레이저, code=microjet, category_id=1, price=1500000, commission_rate=100%
  ...
  ```
- **`commission_rate`** 문자열 “100%” → 숫자 100.00 변환  
- `price` 1500000 → numeric(10,2)에 맞춰서 1500000.00 등등  
- `created_at`, `updated_at` 없으면 `NOW()`.

### 4.7 **regions.csv**

- 테이블: **regions**  
- CSV에서 `id=1~50` 이미 명시. → 그대로 Insert (수동 PK).  
- 최상위(1=대한민국, parent_id=null) → 2=서울(parent_id=1) → … → 19=강남구(parent_id=2) … 순서대로 들어가서 FK 충돌 없음.  
- `created_at`, `updated_at`은 `NOW()`.

### 4.8 **roles.csv**

- 테이블: **roles**  
- CSV 예:  
  ```
  id,name,description,created_at,updated_at
  ,Admin,모든 기능에 접근 가능,,
  ,Sales Manager,영업 팀 관리 및 모든 영업 데이터 접근,,
  ...
  ```
- `id` auto-increment  
- `name`, `description` 매핑, `created_at`, `updated_at` → `NOW()`

### 4.9 **shops.csv**

- 테이블: **shops**  
- CSV 예: name=“건강한 아름다움 휴”, owner_name=“김은형”, status=“active” …  
- `manager_id`, `region_id` 컬럼이 CSV에서 비어 있으므로 null.  
- `converted_from_lead_id`, `kol_id` 또한 CSV에 없으니 null.  
- 나중에 필요하면 `UPDATE shops SET kol_id=? ...`

### 4.10 **users.csv**

- 테이블: **users**  
- CSV 맨 위에 "KOL" 유저들 (예: `zardu80@gmail.com`, role=KOL) / 맨 아래 “SHOP” rows (role=SHOP)  
- NOT NULL 제약이 있는 `email`, `password_hash`가 비어 있으면 임시로 채워넣기  
- `created_at`, `updated_at` → `NOW()`.

---

## 5. (최종) **권장 입력 순서** 통합 안내

1. **roles**  (CSV: roles.csv)  
2. **permissions**  (CSV: permissions.csv)  
3. **role_permissions** (없으면 스킵)  
4. **users**  (CSV: users.csv)  
5. **user_roles** (없으면 스킵)  
6. **lead_sources**  (CSV: lead_sources.csv)  
7. **lead_statuses**  (CSV: lead_statuses.csv)  
8. **product_categories**  (CSV: product_categories.csv)  
   - 먼저 루트(id=1)  
   - 그 뒤 CSV(마이크로젯, 바이오폭스)  
9. **regions** (CSV: regions.csv, id=1~50 수동)  
10. **settings** (목업)  
11. **leads** (CSV: leads.csv)  
    - status_id, source_id, assigned_to 주의  
    - 날짜 변환  
12. **shops** (CSV: shops.csv)  
    - `manager_id`, `region_id` 등 비어 있으면 null  
    - `kol_id`는 null  
13. **kols** (목업 또는 별도 CSV)  
    - user_id, affiliated_shop_id 등  
    - 이후 `UPDATE shops SET kol_id=?`  
14. **products** (CSV: products.csv)  
    - `category_id`, 가격, 커미션율 변환  
15. **customers** (목업이나 별도 CSV)  
16. **sales** → **commissions** → **sales_activities** (목업)  
17. **seminars** → **seminar_attendees** (목업)  
18. **tasks**, **notifications**, **activities** (필요 시 목업)

---

## 6. **마무리**

- **CSV가 있는 테이블(lead_sources, lead_statuses, leads, permissions, product_categories, products, regions, roles, shops, users)**는 위 순서에 맞춰 **부모(참조 대상)**부터 Import하면 FK 위배 없이 깔끔하게 들어갑니다.  
- **leads.csv**처럼 데이터가 많은 파일의 경우, 특히 날짜 변환(`YYYY/MM/DD` → `YYYY-MM-DD`), 메모 문자열의 인용 처리(,나 \n 등)에 주의해야 합니다.  
- 나머지 CSV가 없는 테이블(`kols`, `customers`, `sales`, `commissions`, `activities` 등)은 **목업**을 이용해 FK 관계만 맞춰주면 됩니다.  
- **양방향 FK**나 **자기참조**가 있는 테이블은 한쪽을 `NULL`로 Insert 후, 나중에 `UPDATE`를 거치는 절차가 필요할 수 있습니다.

위 지침에 따라 진행하시면, Supabase(PostgreSQL) 환경에서 대규모 CSV 데이터를 **FK 에러 없이** 이관/마이그레이션할 수 있습니다.  