# 임상사진 관리 Phase 2 구현 가이드

## 📋 현재 상태 및 다음 단계

### Phase 1 완료 사항 ✅
- [x] DB 스키마 생성 (clinical_customers, clinical_cases, clinical_photos)
- [x] 사이드바 메뉴 추가 ("임상사진" 링크)
- [x] 기본 페이지 구조 (/kol-new/clinical-photos)
- [x] 본인/고객 임상 분리된 업로드 페이지
- [x] 체크박스 컴포넌트 생성
- [x] 기본 UI 레이아웃 완성

### Phase 2 목표: 회차별 스크롤 UI 구현 🎯

## 🎨 새로운 UI 설계

### 메인 대시보드 유지
- 현재 `/kol-new/clinical-photos` 페이지는 그대로 유지
- 본인 임상/고객 임상 카드에서 각각 전용 페이지로 이동

### 본인 임상 페이지 개선 (`/upload/personal`)
```
┌─────────────────────────────────────┐
│ [← 뒤로] 본인 임상사진 업로드         │
│                                     │
│ ┌─── 본인 - 보톡스 이마 ───┐         │
│ │ [진행중] [완료]           │         │
│ │                          │         │
│ │ ◀ Before (0일차) ▶       │         │
│ │ ┌───┐ ┌───┐ ┌───┐ ┌───┐ │         │
│ │ │정면│ │좌측│ │우측│ │정면│ │         │
│ │ │ + │ │ + │ │ + │ │7일│ │         │
│ │ └───┘ └───┘ └───┘ └───┘ │         │
│ └──────────────────────────┘         │
│                                     │
│ ┌─── 본인 - 필러 팔자주름 ───┐        │
│ │ [진행중] [완료]            │        │
│ │                           │        │
│ │ ◀ 7일차 ▶                │        │
│ │ ┌───┐ ┌───┐ ┌───┐ ┌───┐  │        │
│ │ │정면│ │좌측│ │우측│ │정면│  │        │
│ │ │ 📷│ │ 📷│ │ + │ │14일│  │        │
│ │ └───┘ └───┘ └───┘ └───┘  │        │
│ └───────────────────────────┘        │
│                                     │
│ [+ 새 케이스 추가]                   │
└─────────────────────────────────────┘
```

### 고객 임상 페이지 개선 (`/upload/customer`)
```
┌─────────────────────────────────────┐
│ [← 뒤로] 고객 임상사진 업로드         │
│                                     │
│ ┌─── 김민지님 - 리프팅 ───┐           │
│ │ [진행중] [완료]         │           │
│ │ □ 동의받음             │           │
│ │                        │           │
│ │ ◀ Before (0일차) ▶     │           │
│ │ ┌───┐ ┌───┐ ┌───┐ ┌───┐ │         │
│ │ │정면│ │좌측│ │우측│ │정면│ │         │
│ │ │ 📷│ │ + │ │ + │ │7일│ │         │
│ │ └───┘ └───┘ └───┘ └───┘ │         │
│ └──────────────────────────┘         │
│                                     │
│ ┌─── 박지영님 - 기미 ───┐             │
│ │ [진행중] [완료]       │             │
│ │ □ 동의받음           │             │
│ │                      │             │
│ │ ◀ 14일차 ▶          │             │
│ │ ┌───┐ ┌───┐ ┌───┐ ┌───┐ │         │
│ │ │정면│ │좌측│ │우측│ │정면│ │         │
│ │ │ 📷│ │ 📷│ │ 📷│ │21일│ │         │
│ │ └───┘ └───┘ └───┘ └───┘ │         │
│ └──────────────────────────┘         │
│                                     │
│ [+ 고객 추가]                        │
└─────────────────────────────────────┘
```

## 🔧 구현 요구사항

### 1. 회차별 스크롤 네비게이션
- **스크롤 순서**: 정면 → 좌측 → 우측 → (다음회차)정면
- **한 화면에 4개 표시**: 현재 회차 3장 + 다음 회차 1장 살짝
- **회차 표시**: 카드 중앙에 "Before", "7일차", "14일차" 등
- **스와이프/드래그 지원**: 모바일 친화적 인터랙션

### 2. 상태 관리 탭
- **탭 구조**: [진행중] [완료]
- **기본값**: 진행중 선택
- **완료 전환**: 수동으로 완료 상태 변경 가능
- **시각적 구분**: 탭 색상/스타일로 상태 구분

### 3. 동의서 간소화 (고객 임상만)
- **기존**: 체크박스 + 날짜 입력
- **개선**: 체크박스만 (□ 동의받음)
- **위치**: 케이스 제목 아래, 회차 네비게이션 위

### 4. 고객 추가 모달 (고객 임상만)
```
┌─── 새 고객 추가 ───┐
│ 고객명: [_______] │
│ 관리명: [_______] │
│ □ 동의받음        │
│ [취소] [추가]     │
└─────────────────┘
```

### 5. 케이스 정렬
- **본인 임상**: 케이스 생성일 역순 (최신이 위)
- **고객 임상**: 고객 생성일 역순 (최근 고객이 위)

## 📁 구현할 컴포넌트

### 새로 생성할 컴포넌트
1. **PhotoRoundCarousel.tsx** - 회차별 스크롤 네비게이션
2. **CaseStatusTabs.tsx** - 진행중/완료 탭
3. **CustomerAddModal.tsx** - 고객 추가 모달
4. **PhotoUploadSlot.tsx** - 개별 사진 업로드 슬롯

### 수정할 페이지
1. **personal/page.tsx** - 본인 임상 페이지 전체 구조 변경
2. **customer/page.tsx** - 고객 임상 페이지 전체 구조 변경

## 🗄️ 데이터 구조

### API 엔드포인트 필요
```
/api/kol-new/clinical-photos/
├── cases/route.ts              # GET: 케이스 목록, POST: 케이스 생성
├── cases/[id]/route.ts         # PUT: 케이스 상태 업데이트
├── cases/[id]/photos/route.ts  # GET: 케이스별 사진 목록
└── photos/upload/route.ts      # POST: 사진 업로드
```

### 데이터베이스 쿼리 패턴
```sql
-- 본인 케이스 목록 (최신순)
SELECT * FROM clinical_cases 
WHERE kol_id = ? AND customer_name = '본인' 
ORDER BY created_at DESC;

-- 고객 케이스 목록 (최신 고객순)
SELECT * FROM clinical_cases 
WHERE kol_id = ? AND customer_name != '본인' 
ORDER BY created_at DESC;

-- 케이스별 사진 목록 (회차+각도순)
SELECT * FROM clinical_photos 
WHERE case_id = ? 
ORDER BY days_from_start ASC, 
         CASE angle 
           WHEN 'front' THEN 1 
           WHEN 'left' THEN 2 
           WHEN 'right' THEN 3 
         END ASC;
```

## 🎯 구현 우선순위

### Step 1: 기본 컴포넌트 생성 (2-3시간)
1. PhotoRoundCarousel 컴포넌트
2. CaseStatusTabs 컴포넌트
3. PhotoUploadSlot 컴포넌트

### Step 2: 본인 임상 페이지 구현 (3-4시간)
1. 새 UI 구조 적용
2. 회차별 스크롤 기능
3. 케이스 추가 기능

### Step 3: 고객 임상 페이지 구현 (4-5시간)
1. 고객별 블록 구현
2. 고객 추가 모달
3. 동의서 간소화
4. 정렬 기능

### Step 4: API 연동 (3-4시간)
1. 케이스 CRUD API
2. 사진 업로드 API
3. 상태 업데이트 API

## ⚠️ 주의사항

### 모바일 최적화
- 터치 스크롤 부드럽게 작동
- 스와이프 제스처 지원
- 버튼 크기 터치 친화적

### 성능 고려
- 이미지 lazy loading
- 썸네일 우선 로드
- 스크롤 성능 최적화

### 기존 시스템 호환성
- 현재 DB 스키마 활용
- 기존 인증 시스템 연동
- 기존 UI 컴포넌트 재사용

---

**다음 단계**: Step 1부터 순차적으로 구현 시작