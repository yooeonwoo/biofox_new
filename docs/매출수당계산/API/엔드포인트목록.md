# 매출수당계산 API 엔드포인트 목록

## 1. 개요

매출수당계산 시스템을 위한 API 엔드포인트 목록과 각 엔드포인트의 역할 및 기능을 설명합니다. 모든 API는 Next.js API 라우트로 구현됩니다.

## 2. 기본 API 경로

모든 매출수당계산 관련 API는 `/api/sales` 경로를 기본으로 합니다.

## 3. API 엔드포인트 목록

### 3.1 매출 및 수당 요약 API

#### `GET /api/sales/monthly-summary`

- **기능**: KOL의 월별 매출, 수당, 전월 대비 비교 데이터 조회
- **쿼리 파라미터**:
  - `kolId`: KOL ID (필수)
  - `yearMonth`: 조회할 연월 (YYYY-MM 형식, 미지정 시 현재 월 기준)
- **응답 예시**:
```json
{
  "success": true,
  "data": {
    "kolId": 1,
    "yearMonth": "2023-08",
    "monthlySales": 5000000,
    "monthlyCommission": 1500000,
    "avgMonthlySales": 4500000,
    "cumulativeCommission": 10000000,
    "previousMonthSales": 4000000,
    "previousMonthCommission": 1200000,
    "activeShopsCount": 5,
    "totalShopsCount": 8
  }
}
```

#### `GET /api/sales/monthly-summary/list`

- **기능**: KOL의 여러 달에 걸친 매출, 수당 요약 데이터 조회
- **쿼리 파라미터**:
  - `kolId`: KOL ID (필수)
  - `limit`: 조회할 개월 수 (기본값: 12)
- **응답 예시**:
```json
{
  "success": true,
  "data": [
    {
      "yearMonth": "2023-08",
      "monthlySales": 5000000,
      "monthlyCommission": 1500000
    },
    {
      "yearMonth": "2023-07",
      "monthlySales": 4000000,
      "monthlyCommission": 1200000
    },
    /* ... */
  ]
}
```

### 3.2 제품 매출 비율 API

#### `GET /api/sales/product-ratios`

- **기능**: 전문점/KOL별 월간 제품 매출 비율 데이터 조회
- **쿼리 파라미터**:
  - `kolId`: KOL ID
  - `shopId`: 전문점 ID
  - `yearMonth`: 조회할 연월 (YYYY-MM 형식, 미지정 시 현재 월 기준)
- **응답 예시**:
```json
{
  "success": true,
  "data": [
    {
      "productId": 1,
      "productName": "큐어부스터",
      "salesAmount": 1000000,
      "salesRatio": 0.2500
    },
    {
      "productId": 2,
      "productName": "올인원세럼",
      "salesAmount": 1500000,
      "salesRatio": 0.3750
    },
    /* ... */
  ]
}
```

### 3.3 전문점 순위 API

#### `GET /api/sales/shop-ranking`

- **기능**: 전문점 순위 데이터 조회
- **쿼리 파라미터**:
  - `kolId`: KOL ID (필수)
  - `sortBy`: 정렬 기준 (current: 당월매출, average: 월평균매출, cumulative: 누적매출, 기본값: current)
  - `yearMonth`: 조회할 연월 (YYYY-MM 형식, 미지정 시 현재 월 기준)
  - `limit`: 조회할 전문점 수 (기본값: 10)
- **응답 예시**:
```json
{
  "success": true,
  "data": [
    {
      "rank": 1,
      "shopId": 3,
      "shopName": "뷰티샵 A",
      "ownerName": "홍길동",
      "currentSales": 2000000,
      "averageSales": 1800000,
      "cumulativeSales": 10000000
    },
    {
      "rank": 2,
      "shopId": 5,
      "shopName": "뷰티샵 B",
      "ownerName": "김철수",
      "currentSales": 1800000,
      "averageSales": 1500000,
      "cumulativeSales": 8000000
    },
    /* ... */
  ]
}
```

### 3.4 전문점 상세 정보 API

#### `GET /api/sales/shop-details/[shopId]`

- **기능**: 특정 전문점의 월별 제품 비율 및 매출/수당 상세 데이터 조회
- **경로 파라미터**:
  - `shopId`: 전문점 ID (필수)
- **쿼리 파라미터**:
  - `yearMonth`: 조회할 연월 (YYYY-MM 형식, 미지정 시 현재 월 기준)
- **응답 예시**:
```json
{
  "success": true,
  "data": {
    "shopInfo": {
      "id": 3,
      "name": "뷰티샵 A",
      "ownerName": "홍길동",
      "region": "서울"
    },
    "salesInfo": {
      "yearMonth": "2023-08",
      "productSales": 2000000,
      "deviceSales": 500000,
      "totalSales": 2500000,
      "commission": 700000
    },
    "productRatios": [
      {
        "productId": 1,
        "productName": "큐어부스터",
        "salesAmount": 500000,
        "salesRatio": 0.2500
      },
      /* ... */
    ],
    "monthlySales": [
      {
        "yearMonth": "2023-08",
        "productSales": 2000000,
        "commission": 600000
      },
      {
        "yearMonth": "2023-07",
        "productSales": 1800000,
        "commission": 540000
      },
      /* ... */
    ]
  }
}
```

### 3.5 매출 및 수당 계산/저장 API

#### `POST /api/sales/register`

- **기능**: 주문 정보를 바탕으로 월별 매출, 수당 데이터를 계산 및 저장
- **요청 본문**:
```json
{
  "orderId": 123,
  "processingType": "new" // new: 새 주문, cancel: 취소 주문
}
```
- **응답 예시**:
```json
{
  "success": true,
  "data": {
    "message": "매출 및 수당 데이터가 성공적으로 등록되었습니다."
  }
}
```

#### `POST /api/sales/calculate-monthly`

- **기능**: 특정 월의 모든 매출 및 수당 데이터를 다시 계산하여 갱신
- **요청 본문**:
```json
{
  "yearMonth": "2023-08"
}
```
- **응답 예시**:
```json
{
  "success": true,
  "data": {
    "message": "2023-08 월의 매출 및 수당 데이터가 성공적으로 갱신되었습니다.",
    "updatedKolsCount": 5,
    "updatedShopsCount": 20
  }
}
```

### 3.6 Cafe24 연동 웹훅 API (목업)

#### `POST /api/mock/cafe24-webhook`

- **기능**: Cafe24에서 주문 발생 시 호출되는 웹훅 API (목업)
- **요청 본문 예시**:
```json
{
  "order_no": "cafe24-20230815-001",
  "shop_name": "뷰티샵 A",
  "total_price": 300000,
  "items": [
    {
      "product_name": "큐어부스터",
      "product_code": "CURE001",
      "price": 74800,
      "quantity": 2
    },
    {
      "product_name": "올인원세럼",
      "product_code": "SERUM001",
      "price": 77000,
      "quantity": 2
    }
  ]
}
```
- **응답 예시**:
```json
{
  "success": true,
  "data": {
    "message": "주문이 성공적으로 처리되었습니다.",
    "orderId": 124
  }
}
```

#### `GET /api/mock/cafe24-orders`

- **기능**: Cafe24 주문 목업 데이터 생성 및 조회
- **쿼리 파라미터**:
  - `count`: 생성할 주문 수 (기본값: 10)
  - `shopId`: 특정 전문점 ID (미지정 시 랜덤 선택)
- **응답 예시**:
```json
{
  "success": true,
  "data": {
    "orders": [
      {
        "order_no": "cafe24-20230815-001",
        "shop_name": "뷰티샵 A",
        "total_price": 300000,
        "items": [/* ... */]
      },
      /* ... */
    ]
  }
}
```

## 4. 에러 응답 형식

모든 API는 에러 발생 시 다음과 같은 형식으로 응답합니다:

```json
{
  "success": false,
  "error": {
    "code": "ERROR_CODE",
    "message": "에러 메시지"
  }
}
```

## 5. 주요 에러 코드

- `INVALID_PARAMS`: 잘못된 파라미터
- `NOT_FOUND`: 요청한 리소스를 찾을 수 없음
- `INTERNAL_ERROR`: 서버 내부 오류
- `AUTHORIZATION_ERROR`: 인증 오류 