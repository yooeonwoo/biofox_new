# 매출수당계산 구현계획

## 1. 개요

이 문서는 KOL 매출 및 수당 계산 시스템의 구현 계획을 설명합니다. 이 시스템은 KOL의 소속 전문점들의 주문 데이터를 기반으로 매출과 수당을 계산하고 관리하는 기능을 제공합니다.

## 2. 주요 요구사항

1. KOL의 소속 전문점들의 주문 데이터를 기반으로 매출과 수당 계산
2. 제품 매출(기기 제외)의 30%가 KOL 수당으로 계산
3. 월별로 KOL별, 전문점별 매출과 수당 관리
4. 제품별 매출 비율 관리
5. 전문점별 순위 관리 (월평균매출, 당월매출, 누적매출 기준)
6. 전문점별 당월매출, 수당, 월평균 매출, 누적 수당 관리
7. KOL 계층 구조 관리 및 상위 KOL에게 하위 KOL 첫 달 매출의 10% 수당 지급
8. 전월과 당월 매출/수당 비교 기능

## 3. 구현 단계

### 3.1 데이터베이스 확장 (1단계)

- 새로운 테이블 스키마 설계 및 구현:
  - `monthly_sales`: KOL별, 전문점별 월별 매출 및 수당 관리
  - `product_sales_ratios`: 전문점별 제품 매출 비율 관리
  - `kol_hierarchy`: KOL 계층 구조 관리
  - `kol_monthly_summary`: KOL 월별 매출/수당 요약 데이터
- 마이그레이션 스크립트 작성

### 3.2 API 엔드포인트 구현 (2단계)

- 매출/수당 계산 로직 구현
- 다음 API 엔드포인트 구현:
  - `/api/sales/monthly-summary`: KOL별 월별 매출, 수당 데이터 조회
  - `/api/sales/product-ratios`: 전문점별 제품 매출 비율 조회
  - `/api/sales/shop-ranking`: 전문점 순위 조회
  - `/api/sales/shop-details/[shopId]`: 특정 전문점 상세 정보 조회
  - `/api/sales/register`: 주문 정보 기반 매출/수당 계산 및 저장
  - `/api/mock/cafe24-orders`: Cafe24 목업 데이터 생성 및 처리

### 3.3 프론트엔드 구현 (3단계)

- 다음 페이지 구현:
  - `app/dashboard/sales`: 매출 및 수당 대시보드
  - `app/dashboard/shops`: 전문점 목록 및 순위
  - `app/dashboard/shops/[shopId]`: 전문점 상세 정보
- 다음 컴포넌트 구현:
  - `components/dashboard/SalesSummary`: 매출/수당 요약 컴포넌트
  - `components/dashboard/ShopRanking`: 전문점 순위 컴포넌트
  - `components/dashboard/ProductRatios`: 제품 비율 시각화 컴포넌트
  - `components/dashboard/MonthlyComparison`: 월별 비교 컴포넌트

### 3.4 테스트 및 디버깅 (4단계)

- 매출/수당 계산 로직 단위 테스트
- API 엔드포인트 통합 테스트
- 프론트엔드 컴포넌트 테스트
- 최종 E2E 테스트

## 4. 구현 일정

| 단계 | 작업 내용 | 예상 소요 시간 |
|------|----------|--------------|
| 1 | 데이터베이스 확장 | 2일 |
| 2 | API 엔드포인트 구현 | 3일 |
| 3 | 프론트엔드 구현 | 4일 |
| 4 | 테스트 및 디버깅 | 2일 |

총 예상 소요 시간: 11일

## 5. 기술 스택

- 프레임워크: Next.js (App Router)
- 데이터베이스: Supabase (PostgreSQL)
- ORM: Drizzle
- UI 컴포넌트: ShadCN
- 데이터 시각화: Recharts
- 테스트: Jest, React Testing Library 